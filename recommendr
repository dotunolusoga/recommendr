#!/usr/bin/env ruby

require "highline/import"

Dir["./app/**/*.rb"].each { |f| require f }
Dir["./lib/*.rb"].each { |f| require f }

menu_prompt = <<EOS
1. Add a recommendation
2. Edit a recommendation
3. Delete a recommendation
4. List all recommendations
5. Exit
EOS

def print_error_message
  puts "[Help] Run as: ./recommendr manage"
end

if ARGV.empty?
  puts 'Can we make a recommendation for you today?(y/n)'
elsif ARGV.size == 1 and ARGV[0] == 'manage'
  loop do
    choose do |menu|
      menu.prompt = ""

      recommendation_controller = RecommendationsController.new

      menu.choice('Add a recommendation') do
        loop do
          user_input = ask("What recommendation would you like to add?")
          response = recommendation_controller.add(user_input)
          say(response) unless response.nil?
          if /has\sbeen\sadded$/.match(response)
            break
          end
        end
      end
      menu.choice('Edit a recommendation') do
        say ("Which recommendation fails to meet your exacting standards 'Oh Great & Powerful One'?\n")
        exit
      end
      menu.choice('Delete a recommendation') do
        say ("Which recommendation fails to meet your exacting standards 'Oh Great & Powerful One'?\n")
        exit
      end
      menu.choice('List all recommendations') do
        say (recommendation_controller.index)
        exit
      end
      menu.choice('Exit') do
        say ("You have successfully exited the management menu.")
        exit
      end
    end
  end
else
  print_error_message
end
